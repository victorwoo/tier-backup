# 压缩备份功能使用指南

## 概述

压缩备份功能允许您将备份文件压缩为ZIP格式，显著节省磁盘空间。这对于长期存储和网络传输特别有用。

## 启用压缩备份

在 `back_config.json` 中设置：

```json
{
    "compress_backup": true,
    "compression_level": 6
}
```

## 压缩级别选择

### 快速压缩（级别1-3）
- **适用场景**：大文件（>1GB）、系统资源有限
- **特点**：压缩速度快，CPU占用低
- **推荐设置**：`"compression_level": 1`

### 平衡模式（级别4-6）
- **适用场景**：一般文件、日常使用
- **特点**：压缩速度和压缩率的平衡
- **推荐设置**：`"compression_level": 6`（默认）

### 高压缩率（级别7-9）
- **适用场景**：小文件（<100MB）、追求最大压缩率
- **特点**：压缩率高，但速度较慢
- **推荐设置**：`"compression_level": 9`

## 文件结构对比

### 目录备份模式
```
backup/
├── hourly/
│   ├── 2025-01-15_1000/
│   │   ├── document1.txt
│   │   ├── document2.txt
│   │   └── backup_info.json
│   └── ...
```

### 压缩备份模式
```
backup/
├── hourly/
│   ├── 2025-01-15_1000.zip
│   └── ...
```

## 压缩效果

根据文件类型，压缩备份通常可以节省：

- **文本文件**：60-80%
- **图片文件**：10-30%（已压缩格式如JPG效果有限）
- **文档文件**：40-70%
- **视频文件**：5-15%（已压缩格式如MP4效果有限）

## 性能影响

### CPU使用率
- 级别1-3：低CPU使用率
- 级别4-6：中等CPU使用率
- 级别7-9：高CPU使用率

### 备份时间
- 压缩会增加备份时间
- 时间增加与文件大小和压缩级别成正比
- 建议在系统负载较低时使用高压缩级别

## 访问压缩备份

### 查看备份内容
```bash
# Windows：使用资源管理器直接双击.zip文件
# macOS：双击.zip文件或使用Finder
# Linux：使用文件管理器或命令行

# 使用命令行
python -m zipfile -l backup/hourly/2025-01-15_1000.zip
```

### 提取备份
```bash
# Windows：右键.zip文件 -> 提取全部
# macOS：双击.zip文件自动解压
# Linux：使用文件管理器或命令行

# 使用命令行
python -m zipfile -e backup/hourly/2025-01-15_1000.zip extract_folder/
```

### 查看元数据
```bash
# 提取元数据文件
python -m zipfile -e backup/hourly/2025-01-15_1000.zip temp/ -p backup_info.json
```

## 配置示例

### 基础配置（推荐新手）
```json
{
    "compress_backup": true,
    "compression_level": 6
}
```

### 高性能配置（大文件）
```json
{
    "compress_backup": true,
    "compression_level": 1
}
```

### 高压缩配置（小文件）
```json
{
    "compress_backup": true,
    "compression_level": 9
}
```

### 调试配置
```json
{
    "compress_backup": true,
    "compression_level": 6,
    "log_level": "DEBUG"
}
```

## 故障排除

### 压缩失败
1. 检查源目录路径是否正确
2. 确保有足够的磁盘空间
3. 检查文件权限
4. 尝试降低压缩级别

### 压缩包损坏
1. 检查磁盘空间是否充足
2. 验证源文件完整性
3. 检查系统内存是否足够

### 性能问题
1. 降低压缩级别
2. 在系统负载较低时运行
3. 考虑使用目录备份模式

## 最佳实践

1. **测试压缩效果**：先用小目录测试压缩效果
2. **监控系统资源**：观察CPU和内存使用情况
3. **定期验证备份**：确保压缩包可以正常解压
4. **选择合适的压缩级别**：根据文件类型和系统性能选择
5. **备份日志监控**：关注压缩相关的日志信息

## 注意事项

- 压缩备份不支持增量备份
- 每次备份都会创建完整的压缩包
- 压缩过程不可中断，确保系统稳定
- 建议定期测试压缩包的完整性
- 压缩备份的元数据存储在ZIP包内 